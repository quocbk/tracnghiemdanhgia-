<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B·∫£ng x·∫øp h·∫°ng</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>üèÜ B·∫£ng x·∫øp h·∫°ng to√†n h·ªá th·ªëng</h2>
    <table id="leaderboard">
      <thead>
        <tr>
          <th>STT</th>
          <th>H·ªç t√™n</th>
          <th>Ti·ªÉu ƒë·ªôi</th>
          <th>S·ªë TT</th>
          <th>ƒêi·ªÉm</th>
          <th>Th·ªùi gian n·ªôp</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="buttons">
      <button id="refresh">üîÑ L√†m m·ªõi</button>
      <button id="sortDesc">‚¨áÔ∏è ƒêi·ªÉm cao ‚Üí th·∫•p</button>
      <button id="sortAsc">‚¨ÜÔ∏è ƒêi·ªÉm th·∫•p ‚Üí cao</button>
      <a href="index.html" class="view-link">‚¨ÖÔ∏è Quay l·∫°i l√†m b√†i</a>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwY-4B5EmPF6pscWXzWFoNfcWUDCN7JuZeardWJZHbkSRbiZ9StSU-65OnqVNj6TUHI/exec"; // D√°n c√πng URL Apps Script ·ªü ƒë√¢y
    const tableBody = document.querySelector("#leaderboard tbody");
    let leaderboard = [];

    async function fetchData() {
      tableBody.innerHTML = "<tr><td colspan='6'>ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>";
      try {
        const res = await fetch(SCRIPT_URL);
        leaderboard = await res.json();
        renderTable(leaderboard.sort((a,b) => b.score - a.score));
      } catch (err) {
        tableBody.innerHTML = "<tr><td colspan='6'>‚ùå L·ªói t·∫£i d·ªØ li·ªáu</td></tr>";
      }
    }

    function renderTable(data) {
  tableBody.innerHTML = "";

  if (data.length === 0) {
    tableBody.innerHTML = "<tr><td colspan='6'>Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>";
    return;
  }

  // S·∫Øp x·∫øp ƒëi·ªÉm gi·∫£m d·∫ßn
  data.sort((a, b) => b.score - a.score);

  // Hi·ªÉn th·ªã th·ª© h·∫°ng
  data.forEach((item, index) => {
    const row = `
      <tr>
        <td>${index + 1}</td>
        <td>${item.name}</td>
        <td>${item.team}</td>
        <td>${item.number}</td>
        <td>${item.score}</td>
        <td>${new Date(item.timestamp).toLocaleString("vi-VN")}</td>
      </tr>
    `;
    tableBody.innerHTML += row;
  });
}


    document.getElementById("refresh").addEventListener("click", fetchData);
    document.getElementById("sortDesc").addEventListener("click", () => renderTable([...leaderboard].sort((a,b)=>b.score-a.score)));
    document.getElementById("sortAsc").addEventListener("click", () => renderTable([...leaderboard].sort((a,b)=>a.score-b.score)));

    fetchData();
  </script>
</body>
</html>
